<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Caffe framework by astorfi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Caffe framework</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/astorfi/Caffe_Installation" class="btn">View on GitHub</a>
      <a href="https://github.com/astorfi/Caffe_Installation/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/astorfi/Caffe_Installation/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="caffe-installation-in-ubuntu-with-gpu-support" class="anchor" href="#caffe-installation-in-ubuntu-with-gpu-support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Caffe Installation In Ubuntu with GPU support</h1>

<p>The step by step processes of caffe installation in <code>Ubuntu(14.04)</code> is provided here. </p>

<h3>
<a id="hardware--cuda-version" class="anchor" href="#hardware--cuda-version" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hardware &amp; cuda version</h3>

<p>The following installation has been implemented and successfully tested on <a href="http://on-demand.gputechconf.com/gtc/2016/webinar/cuda-8-features-overview.pdf">CUDA 8.0</a> and <a href="http://www.geforce.com/hardware/10series/titan-x-pascal">NVIDIA TITAN X(Pwered by Pascal) GPU</a>. However the method can simply be used for older version of <code>CUDA</code> and older <code>GPU architectures</code>.</p>

<h3>
<a id="cuda-installation" class="anchor" href="#cuda-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CUDA installation</h3>

<p>For the <a href="http://www.geforce.com/hardware/10series/titan-x-pascal">NVIDIA TITAN X(Pwered by Pascal) GPU</a>, installing CUDA 8.0 is necessary. The CUDA 8.0 download file and installation procedure can be found <a href="https://developer.nvidia.com/cuda-downloads">here</a>. The system platform has to be chosen as the following image: <img src="images/Select%20Target%20Platform.png" alt="">.</p>

<p>First using the terminal go to the folder that the downloaded <code>.deb</code> file is located. Now the installation has to be done as follows:</p>

<pre><code>sudo dpkg -i cuda-repo-ubuntu1404-8-0-local_8.0.44-1_amd64.deb
sudo apt-get update
sudo apt-get install cuda
</code></pre>

<p>It is worth mentioning that, the described procedure is the straight-forward approach of installing CUDA. Issues like <code>black screen</code>, <code>stuck in login page</code> and other incompatibilities may happen which are beyond the scope of this documentation.</p>

<p>The last step of installation CUDA is to add the path of it to <code>source bash file</code>:</p>

<pre><code>sudo gedit ~/.bashrc
</code></pre>

<p>The the two following line must be added to the file with regard to <code>CUDA 8.0</code> installation:</p>

<pre><code>export PATH=/usr/local/cuda-8.0/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64:$LD_LIBRARY_PATH
</code></pre>

<h4>
<a id="cuda-preinstallation" class="anchor" href="#cuda-preinstallation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CUDA preinstallation</h4>

<p>Before installation of CUDA, It is recommended to uninstall all NVIDIA drivers:</p>

<pre><code>sudo apt-get purge nvidia*
</code></pre>

<p>Still some of the modules might be stuck in the kernel. Get their names by:</p>

<pre><code>dkms status
</code></pre>

<p>The output should be as follows:</p>

<pre><code>nvidia-current-updates, "module_version", "kernel_version", x86_64: installed
</code></pre>

<p><code>Module version</code> and <code>kernel version</code> are of format <code>304.4</code> and <code>3.1.0-36-generic</code> respectively. These modules should be removed by the following command:</p>

<pre><code>sudo dkms remove nvidia-current-updates/module_version -k kernel_version
</code></pre>

<p>Now the CUDA can safely be installed using the aforementioned procedure in the previous section.</p>

<p>Alternatively <code>current-updates</code> can be used since it is a package that is cloned from NVIDIAâ€™s releases,
but it is officially tested and packaged by Ubuntu. The command is as follows:</p>

<pre><code>sudo apt-get install nvidia-current-updates nvidia-settings-updates
</code></pre>

<h3>
<a id="preinstallation-and-cuda-compatibility" class="anchor" href="#preinstallation-and-cuda-compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preinstallation and CUDA compatibility</h3>

<p>Now the assumption is that the <a href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/#axzz4MnU6Gq6E">CUDA</a> is already installed.</p>

<p>Check the supporting GPU(s) and Ubuntu version using the following command:</p>

<pre><code>lspci | grep -i nvidia
uname -m &amp;&amp; cat /etc/*release
 gcc --version
</code></pre>

<h3>
<a id="cudnn-installation" class="anchor" href="#cudnn-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CuDNN Installation</h3>

<p>For increasing the performance(loosly speaking and not necessarily) installing <a href="https://developer.nvidia.com/cudnn">CuDNN</a> is recommended.
After downloading the relevent file to the system, assume the file is downloaded and extracted in the  under
the name of <code>cuda</code>. the go to the folder which <code>cuda</code> is there and run the following:</p>

<pre><code>sudo cp -P cuda/include/cudnn.h /usr/local/cuda/include
sudo cp -P cuda/lib64/libcudnn* /usr/local/cuda/lib64
sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*
</code></pre>

<p>Moreover the path to the CuDNN library must be added to system path as follows:</p>

<pre><code>cd &lt;installpath&gt;
    export LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH
</code></pre>

<h2>
<a id="caffe-installation-using-python" class="anchor" href="#caffe-installation-using-python" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Caffe Installation Using Python</h2>

<p>Caffe has different dependencies which are required by its structure. In the following subsections an abstract list of these dependencies and the commands for installing them are provided. Depending on the available installed packages on the system, more or less dependencies might be required.</p>

<p>The Caffe installation in this documentation uses the build-in python of the 'Ubuntu-Trusty(14.04)'. However 'Anaconda-based' installation can be performed but it is not required as for the moment it has more incompatibilies and may make the installation more complicated.</p>

<p><strong>WARNING:</strong> make sure the <code>Python</code> recognized by the system is the <code>default built-in Python</code> by the ubuntu and <em>Anaconda does not own the path</em> for python. You can check that with the following command which returns the root pf python:</p>

<pre><code>which python
</code></pre>

<p>Basically you need to check that the Anaconda is not installed or the <code>default Python</code> does not belongs to the <code>Anaconda path</code>. With this check-up you can make sure that the <code>Caffe</code> installation does not point to the wrong path. This step is crucial for using <code>Python interface</code> of the <code>Caffe</code>.</p>

<h3>
<a id="installing-git-blas-and-unzip" class="anchor" href="#installing-git-blas-and-unzip" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installing git, BLAS and unzip</h3>

<p><code>BLAS</code> can be used as the backend of matrix and vector computations of Caffe. There are different implementations of this library. <a href="http://www.openblas.net/">OpenBLAS</a> has been chosed. </p>

<pre><code>sudo apt-get install libopenblas-dev git unzip
</code></pre>

<p>Alternatively you can refer to <a href="https://github.com/xianyi/OpenBLAS">OpenBLAS repository</a>.</p>

<h3>
<a id="install-opencv" class="anchor" href="#install-opencv" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install OpenCV</h3>

<p>The <a href="https://help.ubuntu.com/community/OpenCV">OpenCV</a> is the well-known open-source computer vision library.</p>

<p>There are three suggested way for installing OpenCV.</p>

<h4>
<a id="using-bash-script-files" class="anchor" href="#using-bash-script-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using bash script files</h4>

<ol>
<li>Install directly by going to <a href="https://github.com/astorfi/Caffe_Framework/tree/master/Installation/OpenCV_Installation">this link</a> and using one of the "OpenCV.sh" or "OpenCV_Alternative.sh" bash script files available in this repository.

<ul>
<li>The second file is more abstract and installs less dependancies. This may lead to have less conflicts and incompatibilties.</li>
</ul>
</li>
<li>Install as follows for the particular version:

<ul>
<li>The first two files are the edited version of the second method.</li>
</ul>
</li>
</ol>

<pre><code>wget https://raw.githubusercontent.com/jayrambhia/Install-OpenCV/master/Ubuntu/2.4/opencv2_4_9.sh
chmod +x opencv2_4_9.sh 
./opencv2_4_9.sh
</code></pre>

<p>However by using this method, <a href="http://stackoverflow.com/questions/28010399/build-opencv-with-cuda-support">unsupported gpu architecture</a> error has been reported. Most like this is due to requirements of some <code>OpenCV</code> installations to define the "CUDA_GENERATION" explicitly.</p>

<h4>
<a id="install-from-the-source" class="anchor" href="#install-from-the-source" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install from the source</h4>

<p>Install using the source from the <a href="http://docs.opencv.org/2.4/doc/tutorials/introduction/linux_install/linux_install.html">source</a></p>

<h3>
<a id="install-other-dependeciesboost" class="anchor" href="#install-other-dependeciesboost" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install other dependecies(Boost,...)</h3>

<pre><code>sudo apt-get update
sudo apt-get install python-skimage
sudo apt-get install libboost-all-dev
sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev
sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev protobuf-compiler
sudo apt-get install libatlas-base-dev
</code></pre>

<h3>
<a id="install-protobuf" class="anchor" href="#install-protobuf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install protobuf</h3>

<p>For protobuf installation, simple <code>pip installation</code> is recommended.</p>

<pre><code>sudo pip install protobuf
</code></pre>

<p>You may need to install <code>pip</code> before installation of the <code>protobuf</code>.</p>

<h3>
<a id="clone-and-install-caffe-from-source" class="anchor" href="#clone-and-install-caffe-from-source" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Clone and Install Caffe from Source</h3>

<p>In this phase, the Caffe repository must be cloned and install:</p>

<pre><code>git clone https://github.com/BVLC/caffe
</code></pre>

<p>After going to code directory, a copy of <code>Makefile.config.example</code> file under the new name of <code>Makefile.config</code> must be make to be modified if necessary.</p>

<pre><code>cd caffe
cp Makefile.config.example Makefile.config
</code></pre>

<p>For making any modification, the <code>Makefile.config</code> must be edited. Here's are few possible modifications:</p>

<ul>
<li>The CuDNN can be activated using the assigned flag.</li>
<li>Instead of Python, Anaconda can be used by changing the associated paths.</li>
<li>The default is using GPU but if the "CPU_ONLY := 1" is activated, then there is no GPU support!</li>
</ul>

<p>In the end we can compile and make all the test files:</p>

<pre><code>make all
make test
</code></pre>

<p>It is worth mentioning that <code>-jX</code> command can be added to the above commands to increase the speed of process. <code>X</code> is the 
number of supported CPU cores.</p>

<h3>
<a id="installing-pycaffe" class="anchor" href="#installing-pycaffe" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installing Pycaffe</h3>

<p>For having a python interface for the caffe use the following:</p>

<pre><code>cd python
for req in $(cat requirements.txt); do sudo pip install $req; done
cd ..
make pycaffe
</code></pre>

<p>In the above terminal commands the assumption is that we are in the <code>$CAFFE_ROOT</code>. The <code>sudo</code> part is to overcome the
<code>permission denied</code> issue while installing dependencies. However adding <code>sudo</code> has not been mentioned as part of the
documentation provided by the <a href="http://caffe.berkeleyvision.org/installation.html#prerequisites">official Caffe installation</a>, it demonstrated incompatibility by ignoring <code>sudo</code>.</p>

<p>WARNING: The above requirement must be installed in the default python which is in the root otherwise the cannot be recognized by the <code>pycaffe</code>. However using the command <code>sudo apt-get install python-skimage</code> probably immune the installation from its last part which is installing the dependencies defined in the <code>requirements.txt</code> file.</p>

<p>In the end we can run all the tests:</p>

<pre><code>make runtest
</code></pre>

<h3>
<a id="alternatinve-method" class="anchor" href="#alternatinve-method" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Alternatinve Method</h3>

<p>Another way for considering the procedure of the installation is to to the following:</p>

<pre><code>cd python
for req in $(cat requirements.txt); do sudo pip install $req; done
cd ..
</code></pre>

<p>Then make all the necessary elements:</p>

<pre><code>make all
make pycaffe
make test
make runtest
</code></pre>

<p>Now add the following to the <code>source bash file</code>:</p>

<pre><code>export CAFFE_ROOT=/path/to/caffe (ex: /home/username/caffe)
export PYTHONPATH=$CAFFE_ROOT/python:$PYTHONPATH
</code></pre>

<h3>
<a id="installation-check" class="anchor" href="#installation-check" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation check</h3>

<p>By using the following command check if the <code>Caffe</code> is already installed and can be loaded by <code>Pycaffe</code>:</p>

<pre><code>python
import caffe
</code></pre>

<p><strong>CAVEAT:</strong> If you cannot import <code>Caffe</code> that does not mean <code>Caffe</code> is not installed! Passing all tests in the previous phase
guaranties the success of installation <code>Caffe</code>. However not being able to import caffe after running python is related to the pycaffe interface.</p>

<h3>
<a id="reported-issue" class="anchor" href="#reported-issue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Reported Issue</h3>

<p>Then it might be necessary to copy appropriete files be copied in order to prevent <a href="https://github.com/BVLC/caffe/issues/1463">this issue</a>.</p>

<pre><code>sudo cp libhdf5_hl.so.7 libhdf5_hl.so.8
sudo cp libhdf5.so.7 libhdf5.so.8
</code></pre>

<h2>
<a id="caffe-installation-using-anaconda" class="anchor" href="#caffe-installation-using-anaconda" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Caffe Installation Using Anaconda</h2>

<p>At this moment the assumption is that the user wants to install <code>Anaconda</code> and use the <code>Caffe</code>. So after <code>Python Installation Procedure</code>, few modifications must be done.</p>

<h3>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h3>

<p>Anaconda must be downloaded from its <a href="https://www.continuum.io/downloads">website</a>. <code>Anaconda Python 2.7</code> is recommended.</p>

<h3>
<a id="editing-the-bash-file" class="anchor" href="#editing-the-bash-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Editing the bash file</h3>

<p>The following two command should be added to the end of <code>source bash file</code>. However based on the experiments the necessity of the second one has not been proven! </p>

<pre><code>export PATH="/home/username/anaconda/bin:$PATH"
export LD_LIBRARY_PATH=/home/username/anaconda/lib:$LD_LIBRARY_PATH

</code></pre>

<h3>
<a id="installing-protobuf" class="anchor" href="#installing-protobuf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installing protobuf</h3>

<p>The protobuf should be installed this time using <code>conda</code>:</p>

<pre><code>conda install protobuf
</code></pre>

<h2>
<a id="using-pycharm-or-other-ides" class="anchor" href="#using-pycharm-or-other-ides" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using Pycharm or other IDEs</h2>

<p>In order to use the IDE and importing Caffe, The IDE(ex: Pycharm) <em>must be run from the terminal</em>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/astorfi/Caffe_Installation">Caffe framework</a> is maintained by <a href="https://github.com/astorfi">astorfi</a>.</span>

      </footer>

    </section>

  
  </body>
</html>
